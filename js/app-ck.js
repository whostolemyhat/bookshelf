(function(e){var t=[{title:"Javascript the Good Parts",author:"Douglas Crockford",tags:"javascript",url:""},{title:"Javascript the Definitive Guide",author:"David Flanagan",tags:"javascript",url:""},{title:"Head First Design Patterns",author:"Elisabeth Freeman, Eric Freeman, Bert Bates, Kathy Sierra, Elisabeth Robson",tags:"java, design patterns",url:""},{title:"Learning Javascript Design Patterns",author:"Addy Osmani",tags:"javascript, design patterns",url:""},{title:"Head First Java",author:"Bert Bates, Kathy Sierra",tags:"java",url:""},{title:"The Pragmatic Programmer",author:"Andy Hunt, Dave Thomas",tags:"programming",url:""}],n=Backbone.Model.extend({defaults:{img:"/img/placeholder.png"}}),r=Backbone.Collection.extend({model:n}),i=Backbone.View.extend({tagName:"article",className:"book-container",template:e("#bookTemplate").html(),render:function(){var e=_.template(this.template);this.$el.html(e(this.model.toJSON()));return this}}),s=Backbone.View.extend({el:e("#books"),initialize:function(){this.collection=new r(t);this.render();this.$el.find("#filter").append(this.createNav());this.on("change:filterType",function(){console.log(this.filterType);this.filterByTag()},this);this.collection.on("reset",this.render,this)},render:function(){this.$el.find("article").remove();_.each(this.collection.models,function(e){this.renderBook(e)},this)},renderBook:function(e){var t=new i({model:e});this.$el.append(t.render().el)},getTags:function(){var e=_.map(this.collection.pluck("tags"),function(e){return _.map(e.split(","),function(e){return e.trim()})});return _.uniq(_.flatten(e))},createNav:function(){var t=e("<select />",{html:'<option value="all">All</option>'});_.each(this.getTags(),function(n){var r=e("<option />",{value:n.toLowerCase(),text:n.toLowerCase()}).appendTo(t)});return t},events:{"change #filter select":"setFilter","click #add":"addBook"},setFilter:function(e){this.filterType=e.currentTarget.value;this.trigger("change:filterType")},filterByTag:function(){if(this.filterType==="all"){this.collection.reset(t);a.navigate("filter/all")}else{this.collection.reset(t,{silent:!0});var e=this.filterType;filtered=_.filter(this.collection.models,function(t){var n=new RegExp("\\b"+e+"\\b","g");return n.test(t.get("tags"))});this.collection.reset(filtered);a.navigate("filter/"+e)}}}),o=Backbone.Router.extend({routes:{"filter/:tag":"urlFilter"},urlFilter:function(e){console.log(e);u.filterType=e;u.trigger("change:filterType")}}),u=new s,a=new o;Backbone.history.start()})(jQuery);